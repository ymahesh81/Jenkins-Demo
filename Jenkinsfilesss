pipeline {
    agent any

    environment {
        AWS_DEFAULT_REGION = 'ap-south-1' // Specify the AWS region
        CSV_FILE_PATH = 'file.csv' // Path to your CSV file
    }

    stages {
        stage('List S3 Buckets') {
            steps {
                script {
                    def accounts = readCSV file: env.CSV_FILE_PATH, delimiter: ',' // Specify delimiter if needed
                    //accounts.each { row -> 
                    for (account in accounts) {
                        def accountNumber = account.AccountNumber
                        withAWS(region: env.AWS_DEFAULT_REGION, credentials: "awstflab", roleAccount: accountNumber) {
                            echo "Listing S3 buckets for AWS account: ${row}"
                            //sh "aws s3 ls s3:// --profile $accountNumber" // Use AWS CLI to list buckets
                            script{
                            sh "aws s3 ls"
                            }
                        }
                    }
                    }
                }
            }
        }
    }

