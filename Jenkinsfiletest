pipeline {
    agent any

    stages {
        stage('Parse CSV and Set Env') {
            steps {
                script {
                    // Define the path to your CSV file
                    def csvFilePath = "file.csv"

                    // Read the CSV file using the readFile step
                    def csvFileContent = readFile csvFilePath

                    // Split the content into lines
                    def lines = csvFileContent.split('\n')

                    // Assuming the first row of the CSV contains the header
                    def header = lines[0].tokenize(',')

                    // Choose a row index to use as environment variables (e.g., index 1)
                    def rowIndex = 1
                    def row = lines[rowIndex].tokenize(',')

                    // Iterate through the header and row to set environment variables
                    header.eachWithIndex { columnName, index ->
                        // Set environment variable for a specific column
                        env."${columnName.toUpperCase()}_VALUE" = row[index]
                        
                        // Your pipeline steps here
                        echo "Processing ${columnName}: ${row[index]}"
                        echo "DEBUG - Header: ${header}"
                        echo "DEBUG - Row: ${row}"
                    }
                }
            }
        }

        stage('Example Build') {
            steps {
                script {


                    // Access the environment variables set in the previous stage
                    echo "Environment Variable A: ${env.A_VALUE}"
                    echo "Environment Variable B: ${env.B_VALUE}"
                    // Add more as needed
                }
            }
        }
    }
}
